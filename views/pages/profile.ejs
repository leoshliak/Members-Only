<div class="profile-con">
    <h2>Profile Details</h2>
    
    <% if(user.id === currentUser.id) { %>
        <form class="profile-edit" action="/profile/<%= user.id %>" method="POST">
            <div class="input-group">
          <label for="username">Username:</label>
          <input type="text" id="username" name="username" value="<%= user.username %>" required />
          </div>
          <div class="input-group">
          <label for="email">Email:</label>
          <input type="email" id="email" name="email" value="<%= user.email %>" required />
          </div>
            <div class="input-group">
          <label for="first_name">First Name:</label>
          <input type="text" id="first_name" name="first_name" value="<%= user.first_name %>" required />
          </div>
            <div class="input-group">
          <label for="last_name">Last Name:</label>
          <input type="text" id="last_name" name="last_name" value="<%= user.last_name %>" required />
            </div>
            
          <button id="update" type="submit" disabled>Update</button>
            <p class="form-note"><small>Note: You can only update your own profile.</small></p>
        </form>
          <script>
          const updateBtn = document.getElementById('update');
          const inputFields = document.querySelectorAll('input[type="text"], input[type="email"]');
            inputFields.forEach(input => {
                input.addEventListener('input', () => {
                    updateBtn.disabled = false;
                    if (input.value === input.defaultValue && input.value !== '') {
                        updateBtn.disabled = true;
                    }
                });
            });
          </script>
        <% } else { %>
            <div class="other-profile-details">
        <p class="profile-text">Username: <span class="profile-data"><%= user.username %></span></p>
        <p class="profile-text">Email: <span class="profile-data"><%= user.email %></span></p>
        <p class="profile-text">First Name: <span class="profile-data"><%= user.first_name %></span></p>
        <p class="profile-text">Last Name: <span class="profile-data"><%= user.last_name %></span></p>
          </div>
            <% } %>

            <div class="user-messages">
                <h2>Messages</h2>
                <% if(messages.length > 0) { %>
                    <ul class="messages-list">
                        <% messages.forEach(message => { %>
                            <li class="message-item">
                               <div class="message-top"> 
                                <h3><%= message.title %></h3>
                                <%   if(user.id === currentUser.id) { %>
                            <form action="/profile/message/<%= message.id %>" method="POST">
                                <button type="submit"><i class="fa-solid fa-trash-can"></i></button>
                            </form>
                        <% } %> 
                            </div>
                    <p class="message-text"><%= message.text %></p>
                    <p class="message-inf">Written by: <a class="written-by" href="/profile/<%= message.written_by_id %>"><strong><%= message.written_by %></a></strong> on <span class="message-date"><%= message.date_and_time.toLocaleDateString() %></span></p>

                    </li>
                        <% }); %>
                    </ul>
                <% } else { %>
                    <p>No messages found.</p>
                <% } %>
            </div>
</div>